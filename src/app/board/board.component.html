<div class="game-container">
  <h2>Sopa de Letras: Edición Dinámica</h2>

  <div class="timer" [class.game-over]="isGameOver && timeLeft === 0">
    ⏰ Tiempo restante: {{ timeLeft }}s
  </div>

  <div *ngIf="isGameOver && !showWinMenu && timeLeft === 0" class="game-over-modal">
    <div class="game-over-content">
      <h2>¡Game Over!</h2>
      <p>Se acabó el tiempo.</p>
      <button (click)="resetGame()">Reiniciar</button>
      <a class="home-link" routerLink="/" routerLinkActive="active-link"><button>HOME</button></a>
    </div>
  </div>

  <div *ngIf="showWinMenu" class="game-over-modal">
    <div class="game-over-content">
      <h2>¡Felicidades!</h2>
      <p>¡Encontraste todas las respuestas!</p>
      <p>Puntaje final: <b>{{ finalScore }}</b></p>
      <button (click)="resetGame()">Jugar de nuevo</button>
      <a class="home-link" routerLink="/" routerLinkActive="active-link"><button>HOME</button></a>
    </div>
  </div>

  <div class="game-layout" [class.mobile-layout]="isMobileDevice" [class.desktop-layout]="!isMobileDevice">
    <div class="board" *ngIf="board.length > 0">
      <div class="row" *ngFor="let row of board; let i = index">
        <app-cell *ngFor="let cell of row; let j = index"
                  [value]="cell"
                  [isCarPosition]="isCarPosition(i, j)"
                  [isFound]="isPositionFound(i, j)"
                  [foundColor]="getPositionColor(i, j)">
        </app-cell>
      </div>
    </div>
     <div *ngIf="board.length === 0 && currentQuestions.length > 0" class="loading-board">
      Cargando tablero...
    </div>
    <div *ngIf="currentQuestions.length === 0" class="no-questions">
        <p>No hay preguntas disponibles para esta dificultad.</p>
        <p>Por favor, ve al <a routerLink="/admin">Panel de Administrador</a> para agregar algunas.</p>
    </div>


    <div class="target-elements" *ngIf="currentQuestions.length > 0">
      <h3>Encuentra las Respuestas a estas Preguntas:</h3>
      <div class="questions-container">
        <div class="question-item" *ngFor="let question of currentQuestions"
             [style.border-left-color]="answerColors[question.id]"
             [class.question-found]="question.isFound">
          <div class="question-text">
            <strong>{{ question.question }}</strong>
          </div>
          <div class="answer-letters">
            <span *ngFor="let letter of question.answer.split(''); let i = index"
                  [class.found]="isQuestionLetterFound(question.id, i)"
                  [style.background-color]="isQuestionLetterFound(question.id, i) ? answerColors[question.id] : ''">
              {{ letter }}
            </span>
          </div>
          <div class="progress">
            {{ getQuestionProgress(question.id).found }} de {{ getQuestionProgress(question.id).total }} letras
          </div>
        </div>
        <div class="game-actions">
            <a class="home-link" routerLink="/" routerLinkActive="active-link"><button>HOME</button></a>
            <button class="reset-button" type="button" (click)="resetGame()">REINICIAR</button>
        </div>
      </div>
    </div>
  </div>

  <div class="controls" *ngIf="currentQuestions.length > 0">
    <button type="button" class="btn-up" (click)="moveCar('up')">↑</button>
    <button type="button" class="btn-left" (click)="moveCar('left')">←</button>
    <button type="button" class="btn-step">Pasos: {{ steps }}</button>
    <button type="button" class="btn-right" (click)="moveCar('right')">→</button>
    <button type="button" class="btn-down" (click)="moveCar('down')">↓</button>
  </div>

  <div class="keyboard-instructions" *ngIf="!isMobileDevice && currentQuestions.length > 0">
    <p>Usa las flechas del teclado para moverte.</p>
  </div>
</div>
